---
title             : "Tutorial of network analyses of ESM data: the lagnetw package"
shorttitle        : "Tutorial lagnetw"

author: 
  - name          : "Peter Verboon"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "P.O.Box 2960,  6401 DL  Heerlen"
    email         : "Peter.Verboon@ou.nl"
  - name          : "Annelie Beijer "
    affiliation   : "1 "

affiliation:
  - id            : "1"
    institution   : "Open University"

authornote: |
  
abstract: |
  Network analyses have many applications. In this tutorial we focus on networks build with data obtained with the experience sampling method (ESM). The networks are directed, the relations between the variables in the network are directed because lagged predictors are used. An arrow in the network represents an effect from a variable measured at t-1 on another variable measured at t or on itself measured at t.     
  In this tutorial we will show how the package "lagnetw" can be used to do a network analysis.
  
keywords          : "network ESM lags Multilevel"
#wordcount         : "X"

bibliography      : ["Refs_network.bib"]

floatsintext      : yes
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : no
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library("papaja")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```


## Introduction

For this tutorial a network is defined as a visual representation of a set of variables together with the relations between these variables. The aim of such a network is to better understand the underlying process, which has realized the measurements on the variables. etc. etc.
Examples of the network approach in personality research are in [@Costantini2015]. Other papers discuss the psychological networks and their accuracy [@Epskamp2018] and controversial issues related to networks for psychopathology [@Bringmann2018a].

The ` lagnetw ` is in the R package ` lagnetw `. This package can be installed from Github and then loaded using the `library()` function: 

` devtools::install_github("PeterVerboon/lagnetw") `


```{r chunk1, eval = TRUE, echo = TRUE, include = TRUE, warning = FALSE}
library(lagnetw)
```

## ESM 
 short about what and why of ESM data

## Example

The data for this example (DataNews) are obtained in a ESM study about the effect of daily news perception on mood fluctuations. During 10 days, and 7 times per day, participants had to indicate whether they had perceived news, and if they had, to rate the valence of the news using 5 variables. After that they had to rate their mood using items from the PANAS. 
After selecting a relevant subset of the data for this example, we construct an object `vars`, which cobtains the variable names that will be used to build the network. To label the vars in the network plot with convenient symbols, we can define labels, which we add in the object `labs`. Furthermore, groups are defined for the variables in the object `newsGroup`. Variables belonging to each other are placed in the same group. Here we have variables that refer to the news, which indicate the subjective valence of the news (the Valence group), and we have mood items, put in the group called "Affect".
```{r example1, eval = TRUE, echo = TRUE, include = TRUE, warning = FALSE}

data("DataNews")
 # Select the records where news was perceived
dat <- subset(DataNews, News_YesNO == 1)      
vars <- c("Cheerful","Relaxed","Down","Irritated","Insecure","Anxious",
          "Dramatic","Fearful","Hopeful","Inspiring")
labs <- c("CH","REL","DOW", "IRR","INS","ANX","DRA","FF","HO","SPI")
newsGroup <- list(Affect = c(1:6), Valence = c(7:10))
 # select the relevant variables only
dat1 <- dat[,c(vars,c("Participant","daynr","beepnr","Gender2","Age"))]    

res <- esmNetwork(dat=dat1, 
                  subjnr="Participant", 
                  level2 = "daynr", 
                  level1 = "beepnr",
                  vars = vars,
                  covs = c("Gender2","Age"),
                  randomAll = FALSE,
                  randomVars =  NULL,   ## c("Fearful","Hopeful"),
                  layout = "spring",
                  lagn = 1,
                  groups = newsGroup,
                  plimit = 0.05,
                  solid = .20,
                  labs = labs)

plot(res$output$network)

```


## Indices of centrality
To better unbderstand the role of the variables in the network several statistics for a network have been developped, which are called indices of centrality. 

## Note
We used `r cite_r("Refs_network")` for all our analyses.

\newpage

# References
```{r create_references}
r_refs(file = "Refs_network")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
